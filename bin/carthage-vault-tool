#!/usr/bin/python3



import carthage.vault
from carthage.dependency_injection import *
from carthage import base_injector, ConfigLayout
import carthage.utils

def main():
    parser = carthage.utils.carthage_main_argparser()
    parser.add_argument('--ca',
                        help = "Path of CA bundle")
    parser.add_argument(
        '--output-directory',
        '--output-dir',
        help ="Output directory for vault initialization")
    args = carthage.utils.carthage_main_setup(parser)
    carthage.utils.carthage_main_run(run, args)

@inject(config = ConfigLayout,
        ainjector = AsyncInjector)
async def run(args, config, ainjector):
    if args.ca:
        config.vault.ca_bundle = args.ca
    vault = await ainjector(carthage.vault.Vault)
    if not vault.client.is_initialized():
        if not args.output_directory:
            raise ValueError("To initialize a vault you must specify an output directory")
        vault.initialize(args.output_directory)
    breakpoint()
                         

        

if __name__ == '__main__' :
    main()
